---
// src/pages/nosotros.astro
import Layout from "../layouts/Layout.astro";
import { getPageData } from "../lib/wordpress";

// 1. Llamamos a la API
const page = await getPageData("empresa");

if (!page) {
    return Astro.redirect("/404");
}

// 2. Extraemos los datos
const { title, acf } = page;
const { mision_texto, vision_texto, mensaje_gerente, imagen_gerente } =
    acf || {};

// 3. Manejo de errores si no hay foto de gerente
let fotoGerenteUrl = "/placeholder-user.jpg";

if (imagen_gerente) {
    if (typeof imagen_gerente === "number") {
        // Es un ID, necesitamos obtener la URL de la API de medios
        try {
            const mediaRes = await fetch(
                `https://riga-api.vnfcdx.easypanel.host/wp-json/wp/v2/media/${imagen_gerente}`,
            );
            if (mediaRes.ok) {
                const mediaData = await mediaRes.json();
                fotoGerenteUrl = mediaData.source_url || fotoGerenteUrl;
            }
        } catch (e) {
            console.error("Error fetching gerente image:", e);
        }
    } else if (imagen_gerente.url) {
        // Es un objeto (lo ideal)
        fotoGerenteUrl = imagen_gerente.url;
    } else if (typeof imagen_gerente === "string") {
        // Es una URL directa
        fotoGerenteUrl = imagen_gerente;
    }
}
---

<Layout title={title ? title.rendered : "Nosotros - Riga Proyectos"}>
    <!-- Hero Section (Mini) -->
    <section
        class="h-64 relative flex items-center justify-center bg-[url('https://images.unsplash.com/photo-1541888946425-d81bb19240f5?q=80&w=2670')] bg-cover bg-center text-white"
    >
        <div class="absolute inset-0 bg-primary/80 z-0"></div>
        <div class="z-10 text-center">
            <h1
                class="text-5xl md:text-6xl font-bold uppercase tracking-wide"
                set:html={title.rendered}
            />
            <div class="h-1 w-20 bg-accent mx-auto mt-4"></div>
        </div>
    </section>

    <main>
        <!-- Misión y Visión Section -->
        <section class="py-20 bg-construction">
            <div class="container mx-auto px-4">
                <div class="grid md:grid-cols-2 gap-16">
                    <!-- Misión -->
                    <div class="relative group">
                        <div
                            class="absolute -top-4 -left-4 w-16 h-16 bg-accent/20 z-0 group-hover:bg-accent/40 transition"
                        >
                        </div>
                        <div
                            class="relative z-10 bg-white p-10 shadow-lg border-t-4 border-accent h-full"
                        >
                            <h2
                                class="text-3xl font-bold text-primary mb-6 uppercase flex items-center gap-3"
                            >
                                <span class="text-accent text-4xl">01.</span> Misión
                            </h2>
                            <p
                                class="text-gray-600 leading-loose text-lg font-light text-justify"
                            >
                                {mision_texto}
                            </p>
                        </div>
                    </div>

                    <!-- Visión -->
                    <div class="relative group">
                        <div
                            class="absolute -bottom-4 -right-4 w-16 h-16 bg-primary/10 z-0 group-hover:bg-primary/20 transition"
                        >
                        </div>
                        <div
                            class="relative z-10 bg-white p-10 shadow-lg border-t-4 border-primary h-full"
                        >
                            <h2
                                class="text-3xl font-bold text-primary mb-6 uppercase flex items-center gap-3"
                            >
                                <span class="text-primary text-4xl">02.</span> Visión
                            </h2>
                            <p
                                class="text-gray-600 leading-loose text-lg font-light text-justify"
                            >
                                {vision_texto}
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Mensaje del Gerente Section -->
        <section class="py-20 bg-primary text-white relative overflow-hidden">
            <!-- Background Decor -->
            <div
                class="absolute top-0 right-0 text-[15rem] font-bold text-white opacity-5 pointer-events-none leading-none select-none font-display"
            >
                R
            </div>

            <div class="container mx-auto px-4 relative z-10">
                <div class="flex flex-col md:flex-row items-center gap-12">
                    <div
                        class="w-full md:w-1/3 flex justify-center md:justify-end"
                    >
                        <div class="relative">
                            <div
                                class="absolute inset-0 border-2 border-accent translate-x-4 translate-y-4"
                            >
                            </div>
                            <img
                                src={fotoGerenteUrl}
                                alt="Director General"
                                class="relative z-10 w-64 h-80 object-cover shadow-2xl grayscale hover:grayscale-0 transition duration-500"
                            />
                        </div>
                    </div>

                    <div class="w-full md:w-2/3">
                        <h3
                            class="text-accent text-xl font-bold uppercase tracking-widest mb-2"
                        >
                            Liderazgo
                        </h3>
                        <h2
                            class="text-4xl font-bold text-white mb-8 uppercase"
                        >
                            Mensaje del Director
                        </h2>

                        <div class="relative pl-8 border-l-2 border-gray-700">
                            <span
                                class="absolute -top-4 left-4 text-6xl text-gray-700 font-serif"
                                >“</span
                            >
                            <div
                                set:html={mensaje_gerente}
                                class="text-gray-300 text-lg leading-relaxed italic font-light space-y-4"
                            />
                        </div>

                        <div class="mt-8">
                            <p
                                class="text-white font-bold uppercase tracking-wider"
                            >
                                CRISTHIAN GALEANO M.
                            </p>
                            <p class="text-accent text-sm">Director General</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>
</Layout>
