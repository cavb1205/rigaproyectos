---
import Layout from "../../layouts/Layout.astro";
import { getProjectBySlug } from "../../lib/wordpress";
const { slug } = Astro.params;

if (!slug) return Astro.redirect("/404");

const project = await getProjectBySlug(slug);

if (!project) return Astro.redirect("/404");

const acf = project?.acf;

// Helper to get gallery images safely
const gallery = acf?.photo_gallery?.galeria_proyecto?.[0] || [];
const featuredImage = project._embedded?.["wp:featuredmedia"]?.[0]?.source_url;
---

<Layout
    title={`${project.title.rendered} | Riga Proyectos`}
    description={acf?.alcance_obra?.substring(0, 160) ||
        "Conoce más sobre este proyecto de infraestructura realizado por Riga Proyectos."}
    image={featuredImage}
>
    <!-- Hero Section -->
    <section
        class="relative h-[60vh] flex items-end bg-primary overflow-hidden"
    >
        {
            featuredImage && (
                <img
                    src={featuredImage}
                    alt={project.title.rendered}
                    class="absolute inset-0 w-full h-full object-cover opacity-40"
                />
            )
        }
        <div
            class="absolute inset-0 bg-gradient-to-t from-primary via-primary/20 to-transparent"
        >
        </div>

        <div class="container mx-auto px-4 relative z-10 pb-16">
            <div class="flex items-center gap-3 mb-6">
                <span class="h-[2px] w-12 bg-accent"></span>
                <span
                    class="text-accent font-bold uppercase tracking-[0.3em] text-sm"
                    >Proyecto</span
                >
            </div>
            <h1
                class="text-5xl md:text-7xl font-bold text-white uppercase tracking-tighter mb-4"
                set:html={project.title.rendered}
            />
            <p
                class="text-xl text-gray-300 font-light uppercase tracking-widest"
            >
                {acf?.ubicacion_obra || "Localización no especificada"}
            </p>
        </div>
    </section>

    <!-- Project Details -->
    <!-- Project Details -->
    <section class="py-24 bg-construction">
        <div class="container mx-auto px-4">
            <div class="grid md:grid-cols-3 gap-16">
                <!-- Main Content -->
                <div class="md:col-span-2 space-y-12">
                    <div>
                        <h2
                            class="text-3xl font-bold text-primary uppercase mb-6 tracking-tight border-b-2 border-accent inline-block pb-2"
                        >
                            Alcance de la Obra
                        </h2>
                        <div
                            class="text-gray-600 text-lg leading-relaxed whitespace-pre-line font-light"
                        >
                            {
                                acf?.alcance_obra ||
                                    "Información en proceso de actualización."
                            }
                        </div>
                    </div>

                    {
                        gallery.length > 0 && (
                            <div class="space-y-8">
                                <h2 class="text-3xl font-bold text-primary uppercase tracking-tight">
                                    Galería del{" "}
                                    <span class="text-accent">Proyecto</span>
                                </h2>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    {gallery.map((img: any) => (
                                        <div class="aspect-video overflow-hidden bg-gray-200 group">
                                            <img
                                                src={
                                                    img.full_image_url ||
                                                    img.url
                                                }
                                                alt={img.title}
                                                class="w-full h-full object-cover hover:scale-105 transition-transform duration-700 cursor-pointer"
                                            />
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )
                    }
                </div>

                <!-- Sidebar Info -->
                <div class="space-y-8">
                    <div
                        class="bg-white p-10 shadow-xl border-t-8 border-accent"
                    >
                        <h3
                            class="text-xl font-bold text-primary uppercase mb-8 tracking-wider"
                        >
                            Ficha Técnica
                        </h3>

                        <div class="space-y-6">
                            {
                                acf?.cliente_nombre && (
                                    <div>
                                        <span class="block text-xs font-bold text-accent uppercase tracking-widest mb-1">
                                            Cliente
                                        </span>
                                        <span class="text-lg text-primary font-medium">
                                            {acf.cliente_nombre}
                                        </span>
                                    </div>
                                )
                            }

                            {
                                acf?.ubicacion_obra && (
                                    <div>
                                        <span class="block text-xs font-bold text-accent uppercase tracking-widest mb-1">
                                            Ubicación
                                        </span>
                                        <span class="text-lg text-primary font-medium">
                                            {acf.ubicacion_obra}
                                        </span>
                                    </div>
                                )
                            }

                            {
                                acf?.area_construida && (
                                    <div>
                                        <span class="block text-xs font-bold text-accent uppercase tracking-widest mb-1">
                                            Área Construida
                                        </span>
                                        <span class="text-lg text-primary font-medium">
                                            {acf.area_construida} m²
                                        </span>
                                    </div>
                                )
                            }

                            {
                                acf?.ano_finalizacion && (
                                    <div>
                                        <span class="block text-xs font-bold text-accent uppercase tracking-widest mb-1">
                                            Año de Finalización
                                        </span>
                                        <span class="text-lg text-primary font-medium">
                                            {acf.ano_finalizacion}
                                        </span>
                                    </div>
                                )
                            }

                            <div>
                                <span
                                    class="block text-xs font-bold text-accent uppercase tracking-widest mb-1"
                                    >Categoría</span
                                >
                                <span class="text-lg text-primary font-medium">
                                    {
                                        project._embedded?.["wp:term"]?.[0]
                                            ?.map((term: any) => term.name)
                                            .join(", ") || "General"
                                    }
                                </span>
                            </div>
                        </div>
                    </div>

                    <div class="bg-primary p-10 text-white">
                        <h4
                            class="text-xl font-bold uppercase mb-4 text-accent"
                        >
                            ¿Interesado?
                        </h4>
                        <p class="text-sm text-gray-400 mb-6 font-light">
                            Solicita información detallada sobre este tipo de
                            proyectos o cuéntanos tu necesidad.
                        </p>
                        <a
                            href="/contacto"
                            class="block text-center border-2 border-accent text-accent hover:bg-accent hover:text-primary py-3 transition font-bold uppercase tracking-widest text-sm"
                            >Contactar ahora</a
                        >
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Navigation Project -->
    <section class="py-12 border-t border-gray-200 bg-white">
        <div class="container mx-auto px-4 flex justify-between items-center">
            <a
                href="/proyectos"
                class="text-gray-400 hover:text-accent flex items-center gap-2 uppercase tracking-widest text-xs font-bold transition"
            >
                <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="16"
                    height="16"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    ><line x1="19" y1="12" x2="5" y2="12"></line><polyline
                        points="12 19 5 12 12 5"></polyline></svg
                >
                Volver al portafolio
            </a>
        </div>
    </section>
</Layout>
