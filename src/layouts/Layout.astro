---
const { title } = Astro.props;
import "../styles/global.css";
import { getPageData } from "../lib/wordpress";
import Analytics from "@vercel/analytics/astro";

// Fetch site configuration for the header/footer
// Usamos fetch directamente o la funcion getPageData si queremos cachear o estandarizar
const configPage = await getPageData("configuracion-web");
const config = configPage ? configPage.acf : {};

const logoUrl = config.logo_principal
    ? // Si el logo es un ID (numero), necesitariamos hacer otro fetch, pero ACF suele devolver el objeto si esta configurado como 'Image Object'.
      // Segun tu JSON: "logo_principal": 43. Es un ID.
      // Necesitamos hacer un fetch extra si ACF devuelve solo ID, o cambiar ACF para devolver URL.
      // Asumiremos por ahora que quizas podamos obtenerlo de _embedded si pedimos la pagina con _embed,
      // pero getPageData ya usa _embed.
      // Si config.logo_principal es un numero, no tenemos la URL aqui directamente en 'acf'.
      // PERO, si miramos el JSON 'wp:attachment' en _links, podriamos buscarlo.
      // O mejor, actualizamos la funcion para traer el media si es necesario.
      // DADO EL JSON PROVISTO: "logo_principal": 43.
      // Voy a hacer una peque침a trampa: Intentar buscar en _embedded si esta ahi, o usar un placeholder.
      null
    : null;

// Soluci칩n robusta para logo_principal siendo ID:
let logoSrc = "/images/logo-placeholder.png"; // Fallback local
if (config.logo_principal && typeof config.logo_principal === "number") {
    // Si es un ID, intentamos buscarlo en wpm:attachment si viniera embebido (dificil saber cual es cual)
    // O hacemos un fetch rapido al media endpoint
    try {
        const mediaRes = await fetch(
            `https://riga-api.vnfcdx.easypanel.host/wp-json/wp/v2/media/${config.logo_principal}`,
        );
        const mediaData = await mediaRes.json();
        if (mediaData.source_url) {
            logoSrc = mediaData.source_url;
        }
    } catch (e) {
        console.error("Error fetching logo:", e);
    }
} else if (config.logo_principal && config.logo_principal.url) {
    // Si ACF devuelve objeto
    logoSrc = config.logo_principal.url;
}
---

<!doctype html>
<html lang="es" class="scroll-smooth">
    <head>
        <meta charset="UTF-8" />
        <meta
            name="description"
            content="Riga Proyectos - Construcci칩n e Ingenier칤a en Colombia"
        />
        <meta name="viewport" content="width=device-width" />
        <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
        <meta name="generator" content={Astro.generator} />
        <title>{title}</title>

        <!-- Google Fonts: Oswald (Headers) & Inter (Body) -->
        <link rel="preconnect" href="https://fonts.googleapis.com" />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link
            href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=Oswald:wght@300;400;500;700&display=swap"
            rel="stylesheet"
        />
    </head>
    <body class="font-body bg-light text-primary flex flex-col min-h-screen">
        <Analytics />
        <!-- Header / Navigation -->
        <header
            class="bg-primary text-white sticky top-0 z-50 shadow-lg border-b border-gray-800"
        >
            <div
                class="container mx-auto px-4 py-3 flex justify-between items-center"
            >
                <!-- Logo -->
                <a href="/" class="flex items-center gap-3 group">
                    {
                        config.logo_principal ? (
                            <img
                                src={logoSrc}
                                alt="Riga Proyectos"
                                class="h-16 md:h-20 w-auto object-contain bg-white/5 rounded-lg p-1"
                            />
                        ) : (
                            <div class="text-2xl font-bold font-display uppercase tracking-wider">
                                RIGA <span class="text-accent">Proyectos</span>
                            </div>
                        )
                    }
                </a>

                <!-- Desktop Menu -->
                <nav
                    class="hidden md:flex items-center gap-8 text-sm font-medium uppercase tracking-widest"
                >
                    <a
                        href="/"
                        class="hover:text-accent transition duration-300"
                        >Inicio</a
                    >
                    <a
                        href="/nosotros"
                        class="hover:text-accent transition duration-300"
                        >Nosotros</a
                    >
                    <a
                        href="/proyectos"
                        class="hover:text-accent transition duration-300"
                        >Proyectos</a
                    >

                    {
                        config.link_whatsapp && (
                            <a
                                href="/contacto"
                                class="bg-accent text-primary px-5 py-2 hover:bg-white transition duration-300 font-bold flex items-center gap-2 rounded-sm"
                            >
                                Contacto
                            </a>
                        )
                    }
                </nav>

                <!-- Mobile Menu Button (Simple implementation) -->
                <!-- Mobile Menu Button -->
                <button
                    id="mobile-menu-btn"
                    class="md:hidden text-white focus:outline-none"
                >
                    <svg
                        xmlns="http://www.w3.org/2000/svg"
                        class="h-8 w-8"
                        fill="none"
                        viewBox="0 0 24 24"
                        stroke="currentColor"
                    >
                        <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M4 6h16M4 12h16M4 18h16"></path>
                    </svg>
                </button>
            </div>

            <!-- Mobile Menu Dropdown -->
            <nav
                id="mobile-menu"
                class="hidden md:hidden bg-primary border-t border-gray-800"
            >
                <div
                    class="container mx-auto px-4 py-4 flex flex-col space-y-4"
                >
                    <a
                        href="/"
                        class="text-white hover:text-accent font-medium uppercase tracking-widest"
                        >Inicio</a
                    >
                    <a
                        href="/nosotros"
                        class="text-white hover:text-accent font-medium uppercase tracking-widest"
                        >Nosotros</a
                    >
                    <a
                        href="/proyectos"
                        class="text-white hover:text-accent font-medium uppercase tracking-widest"
                        >Proyectos</a
                    >

                    {
                        config.link_whatsapp && (
                            <a
                                href="/contacto"
                                class="bg-accent text-primary px-5 py-3 text-center font-bold flex items-center justify-center gap-2 rounded-sm uppercase tracking-wider"
                            >
                                Contacto
                            </a>
                        )
                    }
                </div>
            </nav>

            <script>
                const btn = document.getElementById("mobile-menu-btn");
                const menu = document.getElementById("mobile-menu");

                if (btn && menu) {
                    btn.addEventListener("click", () => {
                        menu.classList.toggle("hidden");
                    });
                }
            </script>
        </header>

        <slot />

        <!-- Footer Global -->
        <footer
            class="bg-primary text-white py-12 border-t border-gray-800 mt-auto"
        >
            <div class="container mx-auto px-4 grid md:grid-cols-4 gap-8">
                <div class="col-span-1 md:col-span-2">
                    <div class="flex items-center gap-3 mb-4">
                        {
                            config.logo_principal ? (
                                <img
                                    src={logoSrc}
                                    alt="Riga Proyectos"
                                    class="h-12 w-auto brightness-0 invert"
                                />
                            ) : (
                                <h2 class="text-3xl font-bold uppercase tracking-tighter">
                                    RIGA{" "}
                                    <span class="text-accent">Proyectos</span>
                                </h2>
                            )
                        }
                    </div>

                    <p class="text-gray-500 max-w-sm mb-6">
                        Comprometidos con el desarrollo de infraestructura de
                        alta calidad, combinando innovaci칩n y sostenibilidad.
                    </p>

                    {/* Social / Extra Info */}
                    <div class="flex gap-4">
                        {
                            config.link_instagram && (
                                <a
                                    href={config.link_instagram}
                                    target="_blank"
                                    class="bg-gray-800 p-2 rounded-full hover:bg-accent hover:text-primary transition group"
                                    title="S칤guenos en Instagram"
                                >
                                    <svg
                                        xmlns="http://www.w3.org/2000/svg"
                                        width="24"
                                        height="24"
                                        viewBox="0 0 24 24"
                                        fill="none"
                                        stroke="currentColor"
                                        stroke-width="2"
                                        stroke-linecap="round"
                                        stroke-linejoin="round"
                                        class="group-hover:stroke-primary"
                                    >
                                        <>
                                            <rect
                                                x="2"
                                                y="2"
                                                width="20"
                                                height="20"
                                                rx="5"
                                                ry="5"
                                            />
                                            <path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z" />
                                            <line
                                                x1="17.5"
                                                y1="6.5"
                                                x2="17.51"
                                                y2="6.5"
                                            />
                                        </>
                                    </svg>
                                </a>
                            )
                        }
                        {
                            config.link_whatsapp && (
                                <a
                                    href={config.link_whatsapp}
                                    target="_blank"
                                    class="bg-gray-800 p-2 rounded-full hover:bg-green-600 hover:text-white transition group"
                                    title="Chat en WhatsApp"
                                >
                                    <svg
                                        xmlns="http://www.w3.org/2000/svg"
                                        width="24"
                                        height="24"
                                        viewBox="0 0 24 24"
                                        fill="currentColor"
                                    >
                                        <path d="M.057 24l1.687-6.163c-1.041-1.804-1.588-3.849-1.587-5.946.003-6.556 5.338-11.891 11.893-11.891 3.181.001 6.167 1.24 8.413 3.488 2.245 2.248 3.481 5.236 3.48 8.414-.003 6.557-5.338 11.892-11.893 11.892-1.99-.001-3.951-.5-5.688-1.448l-6.305 1.654zm6.597-3.807c1.676.995 3.276 1.591 5.392 1.592 5.448 0 9.886-4.434 9.889-9.885.002-5.462-4.415-9.89-9.881-9.892-5.452 0-9.887 4.434-9.889 9.884-.001 2.225.651 3.891 1.746 5.634l-.999 3.648 3.742-.981zm11.387-5.464c-.074-.124-.272-.198-.57-.347-.297-.149-1.758-.868-2.031-.967-.272-.099-.47-.149-.669.149-.198.297-.768.967-.941 1.165-.173.198-.347.223-.644.074-.297-.149-1.255-.462-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.297-.347.446-.521.151-.172.2-.296.3-.495.099-.198.05-.372-.025-.521-.075-.148-.669-1.611-.916-2.206-.242-.579-.487-.501-.669-.51l-.57-.01c-.198 0-.52.074-.792.372-.272.297-1.04 1.017-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.095 3.2 5.076 4.487.709.306 1.263.489 1.694.626.712.226 1.36.194 1.872.118.571-.085 1.758-.719 2.006-1.413.248-.695.248-1.29.173-1.414z" />
                                    </svg>
                                </a>
                            )
                        }
                    </div>
                </div>

                <div>
                    <h4
                        class="text-lg font-bold uppercase text-accent mb-6 tracking-wider"
                    >
                        Contacto
                    </h4>
                    <ul class="text-gray-400 space-y-4 font-light text-sm">
                        {
                            config.direccion_oficina && (
                                <li class="flex items-start gap-3">
                                    <span class="text-accent text-lg">游늸</span>
                                    <span>{config.direccion_oficina}</span>
                                </li>
                            )
                        }
                        {
                            config.telefono_contacto && (
                                <li class="flex items-center gap-3">
                                    <span class="text-accent text-lg">游</span>
                                    <div>
                                        <a
                                            href={`tel:${config.telefono_contacto}`}
                                            class="hover:text-white transition block"
                                        >
                                            {config.telefono_contacto}
                                        </a>
                                        {config.telefono_contacto_opcional && (
                                            <a
                                                href={`tel:${config.telefono_contacto_opcional}`}
                                                class="hover:text-white transition block mt-1 text-gray-500"
                                            >
                                                {
                                                    config.telefono_contacto_opcional
                                                }
                                            </a>
                                        )}
                                    </div>
                                </li>
                            )
                        }
                        {
                            config.correo_electronico && (
                                <li class="flex items-center gap-3">
                                    <span class="text-accent text-lg">九괦잺</span>
                                    <div>
                                        <a
                                            href={`mailto:${config.correo_electronico}`}
                                            class="hover:text-white transition block"
                                        >
                                            {config.correo_electronico}
                                        </a>
                                        {config.correo_electronico_opcional && (
                                            <a
                                                href={`mailto:${config.correo_electronico_opcional}`}
                                                class="hover:text-white transition block mt-1 text-gray-500 text-xs"
                                            >
                                                {
                                                    config.correo_electronico_opcional
                                                }
                                            </a>
                                        )}
                                    </div>
                                </li>
                            )
                        }
                    </ul>
                </div>

                <div>
                    <h4
                        class="text-lg font-bold uppercase text-accent mb-6 tracking-wider"
                    >
                        Men칰
                    </h4>
                    <ul class="text-gray-400 space-y-3 font-light text-sm">
                        <li>
                            <a
                                href="/"
                                class="hover:text-white transition block py-1 border-b border-gray-800 hover:border-accent"
                                >Inicio</a
                            >
                        </li>
                        <li>
                            <a
                                href="/proyectos"
                                class="hover:text-white transition block py-1 border-b border-gray-800 hover:border-accent"
                                >Proyectos</a
                            >
                        </li>
                        <li>
                            <a
                                href="/nosotros"
                                class="hover:text-white transition block py-1 border-b border-gray-800 hover:border-accent"
                                >Nosotros</a
                            >
                        </li>
                    </ul>
                </div>
            </div>
            <div
                class="border-t border-gray-800 mt-12 pt-8 text-center text-xs text-gray-600 uppercase tracking-widest flex flex-col md:flex-row justify-center items-center gap-4"
            >
                <span
                    >&copy; {new Date().getFullYear()} Riga Proyectos S.A.S. Todos
                    los derechos reservados.</span
                >
                <a
                    href="https://riga-api.vnfcdx.easypanel.host/wp-admin"
                    target="_blank"
                    class="opacity-30 hover:opacity-100 transition-opacity flex items-center gap-1 normal-case tracking-normal"
                >
                    <svg
                        xmlns="http://www.w3.org/2000/svg"
                        width="12"
                        height="12"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        ><rect x="3" y="11" width="18" height="11" rx="2" ry="2"
                        ></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg
                    >
                    <span class="text-[10px]">Admin</span>
                </a>
            </div>
        </footer>
    </body>
</html>
